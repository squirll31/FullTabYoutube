function parseYtUrl(url){var isYoutubeRegex=new RegExp("^(https?://([w]{3}\\.)?youtube\\.com/).+");var isPlaylistUrlExp=new RegExp("/playlist\\?list=");var isVideoUrlRegex=new RegExp("/watch\\?v=");var hasPlaylistPartExp=new RegExp("list=");var isVideoRegex=new RegExp("watch\\?v=");var hasPositionPartExp=new RegExp(".+[\\?&]index=.+");var videoPartExp=new RegExp(".+watch\\?v=([A-Za-z0-9-_]+)(&.+)?");var playlistPartExp=new RegExp(".+[\\?&]list=([A-Za-z0-9_-]+)(&.+)?");var plsPosExp=new RegExp(".+[\\?&]index=([A-Za-z0-9-_]+)(&.+)?");var videoUrlParts={isVideoUrl:!1,isPlaylistUrl:!1,hasPosition:!1,youtubePart:"no",videoId:"no",playlistId:"no",playlistPos:"no",};if(isYoutubeRegex.test(url)){videoUrlParts.youtubePart=url.replace(isYoutubeRegex,"$1")}else{return}
if(isPlaylistUrlExp.test(url)){videoUrlParts.isPlaylistUrl=!0}else if(isVideoUrlRegex.test(url)){videoUrlParts.isVideoUrl=!0}else{return}
if(videoUrlParts.isVideoUrl){videoUrlParts.videoId=url.replace(videoPartExp,"$1");if(hasPlaylistPartExp.test(url)){videoUrlParts.playlistId=url.replace(playlistPartExp,"$1");if(hasPositionPartExp.test(url)){videoUrlParts.playlistPos=url.replace(plsPosExp,"$1");videoUrlParts.hasPosition=!0}}}
if(videoUrlParts.isPlaylistUrl){videoUrlParts.playlistId=url.replace(playlistPartExp,"$1")}
return videoUrlParts}
function createEmbedUrl(videoUrlParts){var finalUrl=videoUrlParts.youtubePart+"embed/";if(videoUrlParts.isPlaylistUrl){finalUrl+="videoseries?list="+videoUrlParts.playlistId}else if(videoUrlParts.isVideoUrl){finalUrl+=videoUrlParts.videoId;if(videoUrlParts.playlistId!="no"){if(videoUrlParts.hasPosition){finalUrl+="?index="+videoUrlParts.playlistPos+"&"}else{finalUrl+="?"}
finalUrl+="list="+videoUrlParts.playlistId}}
return finalUrl}
function GetEmbedLink(url){var videoUrlParts=parseYtUrl(url);if(null===videoUrlParts){return null}
var finalUrl=createEmbedUrl(videoUrlParts);return finalUrl}
function GoToEmbedTab(tab){var url=tab.url;var id=tab.id;var embedurl=GetEmbedLink(url);if(null===embedurl){chrome.tabs.update(id,{url:url})}else{chrome.tabs.update(id,{url:embedurl})}}
chrome.browserAction.onClicked.addListener(GoToEmbedTab)